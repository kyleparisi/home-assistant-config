homeassistant:
  name: Home
  latitude:  39.473055912019305
  longitude: -74.50922252018545
  elevation: 15
  unit_system: imperial
  time_zone: America/New_York
  customize: !include customize.yaml
  packages: !include_dir_named packages

frontend:
 themes: !include_dir_merge_named themes

config:

recorder:
  db_url: !secret db_url
  purge_keep_days: 90

conversation:
history:
logbook:
ffmpeg:
map:
sun:
ios:
influxdb:
  host: 192.168.86.105

http:
  api_password:    !secret http_password
  #  ssl_certificate: /ssl/fullchain.pem
  # ssl_key:         /ssl/privkey.pem
  base_url:        https://home.thegrebs.com

mqtt:
  broker: core-mosquitto
  username: mqtt
  password: !secret mqtt_pass

updater:
  include_used_components: true

discovery:
  ignore:
    - sabnzbd

hue:
  bridges:
    - host: 192.168.86.201

wink:

zwave:
  usb_path: /dev/ttyACM0

panel_iframe:
  energy:
    title: Energy
    url: https://solar.thegrebs.com/
    icon: mdi:power-plug
  grafana:
    title: Grafana
    url: https://home.thegrebs.com/grafana/dashboard/db/main
    icon: mdi:speedometer

weblink:
  entities:
    - name: Configurator
      icon: mdi:wrench
      url: http://hassio.local:3218

nest:
  client_id:     !secret nest_client_id
  client_secret: !secret nest_client_secret

climate:
  - platform: nest
    username: michael@thegrebs.com
    password: !secret nest_password

weather:
  - platform: yweather

sensor:
  - platform: ted5000
    name: main
    host: 192.168.86.50
    port: 80
  - platform: darksky
    api_key: !secret darksky_api_key
    monitored_conditions:
      - summary
      - precip_probability
      - temperature
      - wind_speed
      - cloud_cover
      - humidity
  - platform: bitcoin
    display_options:
      - exchangerate
  - platform: template
    sensors:
      counter_lights_on:
        unit_of_measurement: 'Lights'
        friendly_name: 'Lights on'
        entity_id:
          - switch.on_air
          - light.kitchen
          - light.kitchen_table
          - light.kitchen_accent
          - light.den
          - fan.den_fan
          - light.front_room
          - light.office
          - light.master_bedroom
          - light.downstairs_hall
          - light.upstairs_hall
        value_template: >
          {% if states('group.all_inside') == 'on' %}
          {% for e in states.group.all_inside.attributes.entity_id if states(e) == 'on'  %}
          {% if loop.last %}
          {{ loop.index }}
          {% endif %}
          {%- endfor -%}
          {% else %}
          0
          {% endif %}
  - platform: ups
    username: mikegrb
    password: !secret ups_password
  - platform: octoprint
    name: OctoPrint
    monitored_conditions:
      - Current State
      - Job Percentage

apple_tv:
  # Living Room
  - host: 192.168.86.208
    login_id: !secret apple_tv_login_id
    start_off: true
  # Office
  - host: 192.168.86.101
    login_id: !secret apple_tv_login_id
    start_off: true

octoprint:
  host:    192.168.86.120
  api_key: !secret octoprint_api_key

#media_player:
#  - platform: tivo
#    host: 192.168.86.215
#    name: Den Tivo
#    port: 31339
#    device: 0
#    debug: 0

media_player:
  - platform: alexa

switch:
  - platform: command_line
    switches:
      office_tv:
        friendly_name: Office TV
        command_on: 'curl -X POST http://192.168.86.223:8060/keypress/PowerOn'
        command_off: 'curl -X POST http://192.168.86.223:8060/keypress/PowerOff'
        command_state: 'curl -s GET http://192.168.86.223:8060/query/device-info | grep power-mode | sed -e "s:<power-mode>DisplayOff</power-mode>:OFF:" -e "s:<power-mode>PowerOn</power-mode>:ON:"'
        value_template: '{{ value == "ON" }}'
  - platform: mqtt
    name: "TJ's Desk Lamp"
    state_topic: "stat/tjs_desk/POWER"
    command_topic: "cmnd/tjs_desk/POWER"
    availability_topic: "tele/tjs_desk/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

camera:
  - platform: generic
    name: Mike
    still_image_url: https://maps.googleapis.com/maps/api/staticmap?center={{ states.device_tracker.michaels_iphone.attributes.latitude }},{{ states.device_tracker.michaels_iphone.attributes.longitude }}&zoom=13&size=500x500&maptype=roadmap&markers=color:blue%7Clabel:P%7C{{ states.device_tracker.michaels_iphone.attributes.latitude }},{{ states.device_tracker.michaels_iphone.attributes.longitude }}
    limit_refetch_to_url_change: true
  - platform: generic
    name: Heidi
    still_image_url: https://maps.googleapis.com/maps/api/staticmap?center={{ states.device_tracker.heidi_grebs_iphone.attributes.latitude }},{{ states.device_tracker.heidi_grebs_iphone.attributes.longitude }}&zoom=13&size=500x500&maptype=roadmap&markers=color:blue%7Clabel:P%7C{{ states.device_tracker.heidi_grebs_iphone.attributes.latitude }},{{ states.device_tracker.heidi_grebs_iphone.attributes.longitude }}
    limit_refetch_to_url_change: true
  - platform: generic
    name: RADAR
    still_image_url: https://radblast.wunderground.com/cgi-bin/radar/WUNIDS_map?station=DIX&brand=wui&num=1&delay=15&type=N0R&frame=0&scale=1&noclutter=1&showstorms=0&mapx=400&mapy=240&centerx=400&centery=240&transx=0&transy=0&showlabels=1&severe=1&rainsnow=1&lightning=1&smooth=1&rand=25425955&lat=39.47&lon=-74.51&label=Pomona
  - platform: mjpeg
    name: OctoPrint
    still_image_url: http://192.168.86.120/webcam/?action=snapshot
    mjpeg_url: http://192.168.86.120/webcam/?action=stream
  - platform: uvc
    nvr: 192.168.86.126
    key: !secret uvc_api_key
    password: !secret uvc_pass

tts:
  - platform: google

notify:
  - name: twitter
    platform: twitter
    consumer_key: !secret twitter_consumer_key
    consumer_secret: !secret twitter_consumer_secret
    access_token: !secret twitter_access_token
    access_token_secret: !secret twitter_access_token_secret
  - name: all
    platform: group
    services:
      - service: ios_michaels_iphone
      - service: ios_heidi_grebs_iphone
  - name: all_t
    platform: group
    services:
      - service: ios_michaels_iphone
      - service: ios_heidi_grebs_iphone
      - service: twitter

juicenet:
  access_token: !secret juicenet_api_key

zone:
  - name: School
    latitude: 39.487062
    longitude: -74.515413
    radius: 300
    icon: mdi:school
  - name: ShopRite
    latitude: 39.462512
    longitude: -74.495474
    icon: mdi:cart
  - name: BJs
    latitude: 39.4512411
    longitude: -74.6286195
    icon: mdi:cart
  - name: Simkins
    latitude: 39.487560
    longitude: -74.462958
    radius: 70
    icon: mdi:karate

cloud:
  alexa:
    filter:
      include_domains:
        - switch
        - light
        - fan
        - script
      exclude_entities:
        - light.den_2
        - light.den_3
        - light.office_2
        - light.office_3
        - light.fr_1
        - light.fr_1_2
        - light.fr_2
        - light.fr_2_2
        - light.front_room_2
        - light.entertainment_area_1
        - light.inside_lights
        - switch.outside_front
        - switch.outside_lights
        - light.outside
        - light.downstairs
        - light.outside
        - light.upstairs
    entity_config:
      script.fix_hall_light:
        name: Fix Hall Light
        display_categories: SWITCH
      script.sleep_imac:
        name: Sleep iMac
        display_categories: SWITCH
  google_actions:
    filter:
      include_domains:
        - switch
        - light
        - fan
        - script
      exclude_entities:
        - light.den_2
        - light.den_3
        - light.office_2
        - light.office_3
        - light.fr_1
        - light.fr_1_2
        - light.fr_2
        - light.fr_2_2
        - light.front_room_2
        - light.entertainment_area_1
        - light.inside_lights
        - switch.outside_front
        - switch.outside_lights
        - light.outside
        - light.downstairs
        - light.outside
        - light.upstairs
    entity_config:
      script.fix_hall_light:
        name: Fix Hall Light
      script.sleep_imac:
        name: Sleep iMac

alexa:

homekit:
  auto_start: False
  filter:
    exclude_domains:
      - remote
      - sensor
    exclude_entities:
      - group.kitchen
      - light.den_2
      - light.den_3
      - light.office_2
      - light.office_3
      - light.fr_1
      - light.fr_1_2
      - light.fr_2
      - light.fr_2_2
      - light.front_room_2
      - light.entertainment_area_1
      - sensor.dark_sky_precip_probability
      - light.inside_lights
      - switch.outside_front
      - switch.outside_lights
      - light.outside
      - light.downstairs
      - light.outside
      - light.upstairs

input_number:
  btc_limit:
    name: Current BTC Limit Order
    initial: 0
    min: 0
    max: 999999999
    step: 1
    mode: box
    unit_of_measurement: BTC
    icon: mdi:currency-btc

input_boolean:
  kitchen_accent_motion_triggered:
    name: Kitchen Accent Turned on by motion
    initial: off

timer:
  kitchen_accent:
    duration: '00:10:00'

group:      !include groups.yaml
automation: !include_dir_merge_list automation/
script:     !include scripts.yaml
intent_script: !include alexa.yaml
